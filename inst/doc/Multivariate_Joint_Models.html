<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Dimitris Rizopoulos" />

<meta name="date" content="2018-04-17" />

<title>Multivariate Joint Models</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>



<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />

</head>

<body>




<h1 class="title toc-ignore">Multivariate Joint Models</h1>
<h4 class="author"><em>Dimitris Rizopoulos</em></h4>
<h4 class="date"><em>2018-04-17</em></h4>


<div id="TOC">
<ul>
<li><a href="#multivariate-joint-models---theory">Multivariate Joint Models - Theory</a><ul>
<li><a href="#joint-model-specification">Joint Model Specification</a></li>
<li><a href="#likelihood-and-priors">Likelihood and Priors</a></li>
</ul></li>
<li><a href="#multivariate-joint-models---practice">Multivariate Joint Models - Practice</a><ul>
<li><a href="#the-basic-multivariate-joint-model">The basic multivariate joint model</a></li>
<li><a href="#different-functional-forms">Different Functional Forms</a></li>
<li><a href="#time-varying-effects">Time-varying Effects</a></li>
<li><a href="#left-right-and-interval-censored-data">Left, Right and Interval Censored Data</a></li>
</ul></li>
</ul>
</div>

<div id="multivariate-joint-models---theory" class="section level1">
<h1>Multivariate Joint Models - Theory</h1>
<div id="joint-model-specification" class="section level2">
<h2>Joint Model Specification</h2>
<p>Joint models for longitudinal and survival data have gained a lot of attention the recent years. There have been extended to handle among others multivariate longitudinal data, competing risks and recurrent events, and nowadays there also exist several freely available software packages for their implementation. From the aforementioned extensions, the one that is most practically relevant is the multivariate longitudinal data one. Even though this extension is mathematically straightforward, from a computational viewpoint joint models with multiple longitudinal outcomes remain difficult to fit in practice due to the high number of random effects they require. This difficulty has also hampered to a degree their practical application. The current version of <strong>JMbayes</strong> implements a novel approach that enables fitting such joint models in realistic computing times.</p>
<p>We start with a general definition of the framework of multivariate joint models for multiple longitudinal outcomes and an event time. Let <span class="math inline">\(\mathcal D_n = \{T_i, T_i^U, \delta_i, y_i; i = 1, \ldots, n\}\)</span> denote a sample from the target population, where we let <span class="math inline">\(T_i^*\)</span> denote the true event time for the <span class="math inline">\(i\)</span>-th subject, <span class="math inline">\(T_i\)</span> and <span class="math inline">\(T_i^U\)</span> the observed event times, and <span class="math inline">\(\delta_i \in \{0, 1, 2, 3\}\)</span> denotes the event indicator, with 0 corresponding to right censoring (<span class="math inline">\(T_i^* &gt; T_i\)</span>), 1 to a true event (<span class="math inline">\(T_i^* = T_i\)</span>), 2 to left censoring (<span class="math inline">\(T_i^* &lt; T_i\)</span>), and 3 to interval censoring (<span class="math inline">\(T_i &lt; T_i^* &lt; T_i^U\)</span>). Assuming <span class="math inline">\(K\)</span> longitudinal outcomes we let <span class="math inline">\(y_{ki}\)</span> denote the <span class="math inline">\(n_{ki} \times 1\)</span> longitudinal response vector for the <span class="math inline">\(k\)</span>-th outcome (<span class="math inline">\(k = 1, \ldots, K\)</span>) and the <span class="math inline">\(i\)</span>-th subject, with elements <span class="math inline">\(y_{kij}\)</span> denoting the value of the <span class="math inline">\(k\)</span>-th longitudinal outcome taken at time point <span class="math inline">\(t_{kij}\)</span>, <span class="math inline">\(j = 1, \ldots, n_{ki}\)</span>.</p>
<p>To accommodate multivariate longitudinal responses of different types in a unified framework, we postulate a generalized linear mixed effects model. In particular, the conditional distribution of <span class="math inline">\(y_{ki}\)</span> given a vector of random effects <span class="math inline">\(b_{ki}\)</span> is assumed to be a member of the exponential family, with linear predictor given by <span class="math display">\[g_k \bigl [ E \{ y_{ki}(t) \mid b_{ki} \} \bigr ] = \eta_{ki}(t) =
x_{ki}^\top(t) \beta_k + z_{ki}^\top(t) b_{ki},\]</span> where <span class="math inline">\(g_k(\cdot)\)</span> denotes a known one-to-one monotonic link function, and <span class="math inline">\(y_{ki}(t)\)</span> denotes the value of the <span class="math inline">\(k\)</span>-th longitudinal outcome for the <span class="math inline">\(i\)</span>-th subject at time point <span class="math inline">\(t\)</span>, <span class="math inline">\(x_{ki}(t)\)</span> and <span class="math inline">\(z_{ki}(t)\)</span> denote the design vectors for the fixed-effects <span class="math inline">\(\beta_k\)</span> and for the random effects <span class="math inline">\(b_{ki}\)</span>, respectively. The dimensionality and composition of these design vectors is allowed to differ between the multiple outcomes, and they may also contain a mix of baseline and time-varying covariates. To account for the association between the multiple longitudinal outcomes we link their corresponding random effects. More specifically, the complete vector of random effects <span class="math inline">\(b_i = (b_{1i}, b_{2i}, \ldots, b_{Ki})^\top\)</span> is assumed to follow a multivariate normal distribution with mean zero and variance-covariance matrix <span class="math inline">\(D\)</span>. For the survival process, we assume that the risk for an event depends on a function of the subject-specific linear predictor <span class="math inline">\(\eta_i(t)\)</span> and/or the random effects. More specifically, we have <span class="math display">\[\begin{eqnarray}
\nonumber h_i (t \mid \mathcal H_i(t), w_i(t)) &amp; = &amp;
\lim_{\Delta t \rightarrow 0} \Pr \{ t \leq T_i^* &lt; t + \Delta t \mid T_i^* \geq t, \mathcal H_i(t),
w_i(t) \} \big / \Delta t, \quad t &gt; 0\\
&amp; = &amp; h_0(t) \exp \biggl  [\gamma^\top
w_i(t) + \sum \limits_{k = 1}^K \sum \limits_{l = 1}^{L_k} f_{kl} \{\mathcal H_{ki}(t), w_i(t), b_{ki}, \alpha_{kl} \} \biggr],
\end{eqnarray}\]</span> where <span class="math inline">\(\mathcal H_{ki}(t) = \{ \eta_{ki}(s), 0 \leq s &lt; t \}\)</span> denotes the history of the underlying longitudinal process up to <span class="math inline">\(t\)</span>, <span class="math inline">\(h_0(\cdot)\)</span> denotes the baseline hazard function, <span class="math inline">\(w_i(t)\)</span> is a vector of exogenous, possibly time-varying, covariates with corresponding regression coefficients <span class="math inline">\(\gamma\)</span>. Functions <span class="math inline">\(f_{kl}(\cdot)\)</span>, parameterized by vector <span class="math inline">\(\alpha_{kl}\)</span>, specifies which components/features of each longitudinal outcome are included in the linear predictor of the relative risk model. Some examples, motivated by the literature, are (subscripts <span class="math inline">\(kl\)</span> have been dropped in the following expressions but are assumed): <span class="math display">\[\begin{eqnarray}
f \{\mathcal H_i(t), w_i(t), b_i, \alpha \} &amp; = &amp; \alpha \eta_i(t),\\
f \{\mathcal H_i(t), w_i(t), b_i, \alpha \} &amp; = &amp; \alpha_1 \eta_i(t) + \alpha_2 \eta_i'(t),
\mbox{ with } \eta_i'(t) = \frac{d\eta_i(t)}{dt},\\
f \{\mathcal H_i(t), w_i(t), b_i, \alpha \} &amp; = &amp; \alpha \int_0^t \eta_i(s) \, ds.
\end{eqnarray}\]</span> These formulations of <span class="math inline">\(f(\cdot)\)</span> postulate that the hazard of an event at time <span class="math inline">\(t\)</span> may be associated with the underlying level of the biomarker at the same time point, the slope of the longitudinal profile at <span class="math inline">\(t\)</span> or the accumulated longitudinal process up to <span class="math inline">\(t\)</span>. In addition, the specified terms from the longitudinal outcomes may also interact with some covariates in the <span class="math inline">\(w_i(t)\)</span>. Furthermore, note, that we allow a combination of <span class="math inline">\(L_k\)</span> functional forms per longitudinal outcome. Finally, the baseline hazard function <span class="math inline">\(h_0(\cdot)\)</span> is modeled flexibly using a B-splines approach, i.e., <span class="math display">\[\log h_0(t) = \sum \limits_{q = 1}^Q \gamma_{h_0,q} B_q(t, v),\]</span> where <span class="math inline">\(B_q(t, v)\)</span> denotes the <span class="math inline">\(q\)</span>-th basis function of a B-spline with knots <span class="math inline">\(v_1, \ldots, v_Q\)</span> and <span class="math inline">\(\gamma_{h_0}\)</span> the vector of spline coefficients. To avoid the task of choosing the appropriate number and position of the knots, we include a relatively high number of knots (e.g., 15 to 20) and appropriately penalize the B-spline regression coefficients <span class="math inline">\(\gamma_{h_0}\)</span> for smoothness using the differences penalty.</p>
</div>
<div id="likelihood-and-priors" class="section level2">
<h2>Likelihood and Priors</h2>
<p>For the estimation of joint model’s parameters we will use a Bayesian approach. The posterior distribution of the model parameters given the observed data is derived under the assumptions that given the random effects, the longitudinal outcomes are independent from the event times, the multiple longitudinal outcomes are independent of each other, and the longitudinal responses of each subject in each outcome are independent. Under these assumptions the posterior distribution is analogous to: <span class="math display">\[\begin{eqnarray}
p(\theta, b) \propto \prod \limits_{i = 1}^n \prod \limits_{k = 1}^K \prod \limits_{j = 1}^{n_{ki}}
p (y_{kij} \mid b_{ki}, \theta) \; p(T_i, T_i^U, \delta_i \mid b_{ki}, \theta) \; p(b_{ki} \mid \theta) \; p(\theta), 
\end{eqnarray}\]</span> where <span class="math inline">\(\theta\)</span> denotes the full parameter vector, and <span class="math display">\[p (y_{kij} \mid b_{ki}, \theta) = \exp \biggl \{ \Bigl [y_{kij} \psi_{kij}(b_{ki}) - c_k\{\psi_{kij}(b_{ki})\} \Bigr ] \Big / a_k(\varphi) - d_k(y_{kij}, \varphi) \biggr \},\]</span> with <span class="math inline">\(\psi_{kij}(b_{ki})\)</span> and <span class="math inline">\(\varphi\)</span> denoting the natural and dispersion parameters in the exponential family, respectively, <span class="math inline">\(c_k(\cdot)\)</span>, <span class="math inline">\(a_k(\cdot)\)</span>, and <span class="math inline">\(d_k(\cdot)\)</span> are known functions specifying the member of the exponential family. For the survival part accordingly we have <span class="math display">\[\begin{eqnarray}
p(T_i, T_i^U, \delta_i \mid b_i, \theta) &amp; = &amp;\Bigr \{h_i (T_i \mid \mathcal H_i(T_i), w_i(T_i)) \Bigr \}^{I(\delta_i = 1)} \exp \biggl \{- \int_0^{T_i} h_i (s \mid \mathcal H_i(s), w_i(s)) \; ds \biggr \}^{I(\delta_i \in \{0, 1\})}\\
\nonumber &amp; \times &amp;  \Biggl \{1 - \exp \biggl \{- \int_0^{T_i} h_i (s \mid \mathcal H_i(s), w_i(s)) \; ds \biggr \}\Biggr\}^{I(\delta_i = 2)}\\
&amp; \times &amp; \Biggl \{\exp \biggl \{- \int_0^{T_i} h_i (s \mid \mathcal H_i(s), w_i(s)) \; ds \biggr \} - \exp \biggl \{- \int_0^{T_i^U} h_i (s \mid \mathcal H_i(s), w_i(s)) \; ds \biggr \} \Biggr\}^{I(\delta_i = 3)}, 
\end{eqnarray}\]</span> where <span class="math inline">\(I(\cdot)\)</span> denotes the indicator function. The integral in the definition of the cumulative hazard function does not have a closed-form solution, and thus a numerical method must be employed for its evaluation. Standard options are the Gauss-Kronrod and Gauss-Legendre quadrature rules.</p>
<p>For the parameters of the longitudinal outcomes we use standard default priors. More specifically, independent normal priors with zero mean and variance 1000 for the fixed effects and inverse Gamma priors for scale parameters. The covariance matrix of the random effects is parameterized in terms of a correlation matrix <span class="math inline">\(\Omega\)</span> and a vector of <span class="math inline">\(\sigma_{d}\)</span>. For the correlation matrix <span class="math inline">\(\Omega\)</span> we use LKJ-Correlation prior proposed by with parameter <span class="math inline">\(\zeta = 1.5\)</span>. For each element of <span class="math inline">\(\sigma_{d}\)</span> we use a half-Student’s t prior with 3 degrees of freedom. For the regression coefficients <span class="math inline">\(\gamma\)</span> of the relative risk model we assume independent normal priors with zero mean and variance 1000. The same prior is also assumed for the vector of association parameters <span class="math inline">\(\alpha\)</span>. However, when <span class="math inline">\(\alpha\)</span> becomes high dimensional (e.g., when several functional forms are considered per longitudinal outcome), we opt for a global-local ridge-type shrinkage prior, i.e., for the <span class="math inline">\(s\)</span>-th element of <span class="math inline">\(\alpha\)</span> we assume <span class="math display">\[\alpha_s \sim \mathcal N (0, \tau \psi_s), \quad \tau^{-1} \sim \mbox{Gamma}(0.1, 0.1), \quad \psi_s^{-1} \sim \mbox{Gamma}(1, 0.01).\]</span> The global smoothing parameter <span class="math inline">\(\tau\)</span> has sufficiently mass near zero to ensure shrinkage, while the local smoothing parameter <span class="math inline">\(\psi_s\)</span> allows individual coefficients to attain large values. Other options of shrinkage or variable-selection priors could be used as well. Finally, the penalized version of the B-spline approximation to the baseline hazard is specified using the following hierarchical prior for <span class="math inline">\(\gamma_{h_0}\)</span>: <span class="math display">\[p(\gamma_{h_0} \mid \tau_h) \propto \tau_h^{\rho(K)/2}\exp \Bigl (-\frac{\tau_{h}}{2}
\gamma_{h_0}^\top K \gamma_{h_0} \Bigr ),\]</span> where <span class="math inline">\(\tau_h\)</span> is the smoothing parameter that takes a <span class="math inline">\(\mbox{Gamma}(1, \tau_{h\delta} )\)</span> prior distribution, with a hyper-prior <span class="math inline">\(\tau_{h\delta} \sim \mbox{Gamma}(10^{-3}, 10^{-3})\)</span>, which ensures a proper posterior distribution for <span class="math inline">\(\gamma_{h_0}\)</span>, <span class="math inline">\(K = \Delta_r^\top \Delta_r + 10^{-6}I\)</span>, with <span class="math inline">\(\Delta_r\)</span> denoting the <span class="math inline">\(r\)</span>-th difference penalty matrix, and <span class="math inline">\(\rho(K)\)</span> denotes the rank of <span class="math inline">\(K\)</span>.</p>
</div>
</div>
<div id="multivariate-joint-models---practice" class="section level1">
<h1>Multivariate Joint Models - Practice</h1>
<div id="the-basic-multivariate-joint-model" class="section level2">
<h2>The basic multivariate joint model</h2>
<p>The function that fits multivariate joint models in <strong>JMbayes</strong> is called <code>mvJointModelBayes()</code> and has a very similar syntax as the <code>jointModelBayes()</code> function. However, contrary to <code>jointModelBayes()</code> that is entirely written in <code>R</code>, the main bulk of computations of <code>mvJointModelBayes()</code> are based on <code>C++</code> code building upon the excellent <a href="https://cran.r-project.org/package=Rcpp">Rcpp</a> and <a href="https://cran.r-project.org/package=RcppArmadillo">RcppArmadillo</a> packages.</p>
<p>To make the connection between the two functions from a practical viewpoint more clear, let’s fit first a univariate joint model using <code>mvJointModelBayes()</code>. As for <code>jointModelBayes()</code>, we first need to separately fit a mixed-effects model for the longitudinal outcome, and a Cox model for the survival outcome. However, contrary to <code>jointModelBayes()</code>, which required the mixed model to be fitted with function <code>lme()</code> from the <a href="https://cran.r-project.org/package=nlme">nlme</a> package, for <code>mvJointModelBayes()</code> the mixed model needs to be fitted with function <code>mvlgmer()</code>. This follows the syntax of <code>lmer()</code> from package <a href="https://cran.r-project.org/package=lme4">lme4</a>. For example, the code below fits a linear mixed model for the longitudinal biomarker serum bilirubin from the Mayo Clinic PBC data set:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">MixedModelFit1 &lt;-<span class="st"> </span><span class="kw">mvglmer</span>(<span class="kw">list</span>(<span class="kw">log</span>(serBilir) <span class="op">~</span><span class="st"> </span>year <span class="op">+</span><span class="st"> </span>(year <span class="op">|</span><span class="st"> </span>id)), <span class="dt">data =</span> pbc2,
                          <span class="dt">families =</span> <span class="kw">list</span>(gaussian))</code></pre></div>
<p>The main arguments of this function are: <code>formulas</code> a list of lme4-like formulas (a formula per outcome), <code>data</code> a data.frame that contains all the variables specified in formulas (NAs allowed), and <code>families</code> a list of <a href="https://stat.ethz.ch/R-manual/R-devel/library/stats/html/family.html">family</a> objects specifying the type of each outcome (currently the gaussian, binomial and poisson families are allowed). Following, we fit a Cox model using function <code>coxph()</code> from the <a href="https://cran.r-project.org/package=survival">survival</a> package; argument <code>model</code> of <code>coxph()</code> needs to be set to <code>TRUE</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pbc2.id<span class="op">$</span>Time &lt;-<span class="st"> </span>pbc2.id<span class="op">$</span>years
pbc2.id<span class="op">$</span>event &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(pbc2.id<span class="op">$</span>status <span class="op">!=</span><span class="st"> &quot;alive&quot;</span>)
CoxFit &lt;-<span class="st"> </span><span class="kw">coxph</span>(<span class="kw">Surv</span>(Time, event) <span class="op">~</span><span class="st"> </span>drug <span class="op">+</span><span class="st"> </span>age, <span class="dt">data =</span> pbc2.id, <span class="dt">model =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p>Then the univariate joint model is fitted by the following simple call to <code>mvJointModelBayes()</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">JMFit1 &lt;-<span class="st"> </span><span class="kw">mvJointModelBayes</span>(MixedModelFit1, CoxFit, <span class="dt">timeVar =</span> <span class="st">&quot;year&quot;</span>)
<span class="kw">summary</span>(JMFit1)</code></pre></div>
<pre><code>## 
## Call:
## mvJointModelBayes(mvglmerObject = MixedModelFit1, survObject = CoxFit, 
##     timeVar = &quot;year&quot;)
## 
## Data Descriptives:
## Number of Groups: 312        Number of events: 169 (54.2%)
## Number of Observations:
##   log(serBilir): 1945
## 
## Random-effects covariance matrix:
##       StdDev    Corr
## (I)1  1.0081  (Int)1
## yer1  0.1735  0.4016
## 
## Survival Outcome:
##                     PostMean  StDev  StErr    2.5%  97.5%     P
## drugD-penicil        -0.0580 0.1578 0.0039 -0.3632 0.2446 0.728
## age                   0.0430 0.0078 0.0003  0.0284 0.0578 0.000
## log(serBilir)_value   1.3054 0.0829 0.0022  1.1492 1.4789 0.000
## 
## Longitudinal Outcome: log(serBilir) (family = gaussian, link = identity)
##             PostMean  StDev  StErr   2.5%  97.5% P
## (Intercept)   0.4956 0.0596 0.0019 0.3767 0.6096 0
## year          0.1764 0.0130 0.0004 0.1522 0.2026 0
## sigma         0.3489 0.0067 0.0002 0.3366 0.3627 0
## 
## MCMC summary:
## iterations: 900 
## burn-in: 600 
## thinning: 300 
## time: 2.6 min</code></pre>
<p>To fit a multivariate joint model for multiple longitudinal outcomes, the only thing that needs to be adapted from the procedure described above, is the call to <code>mvglmer()</code>. For example, to fit a bivariate joint model for serum bilirubin and presence of spiders, we use the syntax:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">MixedModelFit2 &lt;-<span class="st"> </span><span class="kw">mvglmer</span>(<span class="kw">list</span>(<span class="kw">log</span>(serBilir) <span class="op">~</span><span class="st"> </span>year <span class="op">+</span><span class="st"> </span>(year <span class="op">|</span><span class="st"> </span>id),
                               spiders <span class="op">~</span><span class="st"> </span>year <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>id)), <span class="dt">data =</span> pbc2,
                          <span class="dt">families =</span> <span class="kw">list</span>(gaussian, binomial))

JMFit2 &lt;-<span class="st"> </span><span class="kw">mvJointModelBayes</span>(MixedModelFit2, CoxFit, <span class="dt">timeVar =</span> <span class="st">&quot;year&quot;</span>)
<span class="kw">summary</span>(JMFit2)</code></pre></div>
<pre><code>## 
## Call:
## mvJointModelBayes(mvglmerObject = MixedModelFit2, survObject = CoxFit, 
##     timeVar = &quot;year&quot;)
## 
## Data Descriptives:
## Number of Groups: 312        Number of events: 169 (54.2%)
## Number of Observations:
##   log(serBilir): 1945
##   spiders: 1887
## 
## Random-effects covariance matrix:
##       StdDev    Corr        
## (I)1  1.0066  (Int)1   year1
## yer1  0.1723  0.4135        
## (I)2  3.0810  0.4736  0.4288
## 
## Survival Outcome:
##                     PostMean  StDev  StErr    2.5%  97.5%     P
## drugD-penicil        -0.0985 0.1536 0.0035 -0.3728 0.2178 0.516
## age                   0.0422 0.0079 0.0002  0.0267 0.0577 0.000
## log(serBilir)_value   1.2678 0.0957 0.0024  1.0879 1.4629 0.000
## spiders_value         0.0562 0.0435 0.0014 -0.0280 0.1376 0.188
## 
## Longitudinal Outcome: log(serBilir) (family = gaussian, link = identity)
##             PostMean  StDev  StErr   2.5%  97.5% P
## (Intercept)   0.4967 0.0592 0.0019 0.3795 0.6094 0
## year          0.1786 0.0129 0.0004 0.1533 0.2037 0
## sigma         0.3495 0.0068 0.0002 0.3360 0.3649 0
## 
## Longitudinal Outcome: spiders (family = binomial, link = logit)
##             PostMean  StDev  StErr    2.5%   97.5% P
## (Intercept)  -1.6716 0.2212 0.0150 -2.1535 -1.2896 0
## year          0.1830 0.0303 0.0032  0.1234  0.2408 0
## 
## MCMC summary:
## iterations: 900 
## burn-in: 600 
## thinning: 300 
## time: 3.9 min</code></pre>
</div>
<div id="different-functional-forms" class="section level2">
<h2>Different Functional Forms</h2>
<p>Function <code>mvJointModelBayes()</code> allows to specify different functional forms for the longitudinal outcomes that are included in the Cox model. As an example, we extend model <code>JMFit2</code> by including the value and slope term for bilirubin, and the area term for spiders (in the log-odds scale). To include these terms into the model we specify the <code>Formulas</code> argument. This is specified in a similar manner as the <code>derivForms</code> argument of <code>jointModelBayes()</code>. In particular, it should be a list of lists. Each component of the outer list should have as name the name of the corresponding outcome variable. Then in the inner list we need to specify four components, namely, the <code>fixed</code> &amp; <code>random</code> R formulas specifying the fixed and random effects part of the term to be included, and <code>indFixed</code> &amp; <code>indRandom</code> integer indices specifying which of the original fixed and random effects are involved in the calculation of the new term. In the inner list you can also optionally specify a name for the term you want to include. A couple of notes:</p>
<ol style="list-style-type: decimal">
<li>For terms not specified in the <code>Formulas</code> list, the default value functional form is used.</li>
<li>If for a particular outcome you want to include both the value functional form and an extra term, then you need to specify that in the <code>Formulas</code> using two entries. To include the value functional form you only need to set the corresponding to <code>&quot;value&quot;</code>, and for the second term to specify the inner list. See example below on how to include the value and slope for serum bilirubin (for example, if the list below the entry <code>&quot;log(serBilir)&quot; = &quot;value&quot;</code> was not given, then only the slope term would have been included in the survival submodel).</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Forms &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="st">&quot;log(serBilir)&quot;</span> =<span class="st"> &quot;value&quot;</span>,
              <span class="st">&quot;log(serBilir)&quot;</span> =<span class="st"> </span><span class="kw">list</span>(<span class="dt">fixed =</span> <span class="op">~</span><span class="st"> </span><span class="dv">1</span>, <span class="dt">random =</span> <span class="op">~</span><span class="st"> </span><span class="dv">1</span>,
                                     <span class="dt">indFixed =</span> <span class="dv">2</span>, <span class="dt">indRandom =</span> <span class="dv">2</span>, <span class="dt">name =</span> <span class="st">&quot;slope&quot;</span>),
              <span class="st">&quot;spiders&quot;</span> =<span class="st"> </span><span class="kw">list</span>(<span class="dt">fixed =</span> <span class="op">~</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span>year <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(year<span class="op">^</span><span class="dv">2</span><span class="op">/</span><span class="dv">2</span>), <span class="dt">random =</span> <span class="op">~</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span>year,
                               <span class="dt">indFixed =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, <span class="dt">indRandom =</span> <span class="dv">1</span>, <span class="dt">name =</span> <span class="st">&quot;area&quot;</span>))

JMFit3 &lt;-<span class="st"> </span><span class="kw">update</span>(JMFit2, <span class="dt">Formulas =</span> Forms)
<span class="kw">summary</span>(JMFit3)</code></pre></div>
<pre><code>## 
## Call:
## mvJointModelBayes(mvglmerObject = MixedModelFit2, survObject = CoxFit, 
##     timeVar = &quot;year&quot;, Formulas = Forms)
## 
## Data Descriptives:
## Number of Groups: 312        Number of events: 169 (54.2%)
## Number of Observations:
##   log(serBilir): 1945
##   spiders: 1887
## 
## Random-effects covariance matrix:
##       StdDev    Corr        
## (I)1  1.0066  (Int)1   year1
## yer1  0.1723  0.4135        
## (I)2  3.0810  0.4736  0.4288
## 
## Survival Outcome:
##                     PostMean  StDev  StErr    2.5%  97.5%     P
## drugD-penicil        -0.1139 0.1677 0.0041 -0.4455 0.2137 0.490
## age                   0.0430 0.0079 0.0002  0.0267 0.0583 0.000
## log(serBilir)_value   1.2288 0.1106 0.0023  1.0125 1.4473 0.000
## log(serBilir)_slope   2.0192 0.9277 0.0293  0.2282 3.8321 0.034
## spiders_area         -0.0077 0.0078 0.0002 -0.0237 0.0072 0.306
## 
## Longitudinal Outcome: log(serBilir) (family = gaussian, link = identity)
##             PostMean  StDev  StErr   2.5%  97.5% P
## (Intercept)   0.4967 0.0592 0.0019 0.3795 0.6094 0
## year          0.1786 0.0129 0.0004 0.1533 0.2037 0
## sigma         0.3495 0.0068 0.0002 0.3360 0.3649 0
## 
## Longitudinal Outcome: spiders (family = binomial, link = logit)
##             PostMean  StDev  StErr    2.5%   97.5% P
## (Intercept)  -1.6716 0.2212 0.0150 -2.1535 -1.2896 0
## year          0.1830 0.0303 0.0032  0.1234  0.2408 0
## 
## MCMC summary:
## iterations: 900 
## burn-in: 600 
## thinning: 300 
## time: 4.2 min</code></pre>
<p>We further extend the previous model by including the interactions terms between the terms specified in <code>Formulas</code> and the randomized treatment indicator drug. The names specified in the list that defined the interaction factors should match with the names of the output from <code>JMFit3</code>. Because of the many association parameters we place thre shrinkage prior on the association coefficients described above. In particular:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Ints &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="st">&quot;log(serBilir)&quot;</span> =<span class="st"> </span><span class="er">~</span><span class="st"> </span>drug, <span class="st">&quot;log(serBilir)_slope&quot;</span> =<span class="st"> </span><span class="er">~</span><span class="st"> </span>drug,
             <span class="st">&quot;spiders_area&quot;</span> =<span class="st"> </span><span class="er">~</span><span class="st"> </span>drug)

JMFit4 &lt;-<span class="st"> </span><span class="kw">update</span>(JMFit3, <span class="dt">Interactions =</span> Ints, <span class="dt">priors =</span> <span class="kw">list</span>(<span class="dt">shrink_alphas =</span> <span class="ot">TRUE</span>))
<span class="kw">summary</span>(JMFit4)</code></pre></div>
<pre><code>## 
## Call:
## mvJointModelBayes(mvglmerObject = MixedModelFit2, survObject = CoxFit, 
##     timeVar = &quot;year&quot;, Formulas = Forms, Interactions = Ints, 
##     priors = list(shrink_alphas = TRUE))
## 
## Data Descriptives:
## Number of Groups: 312        Number of events: 169 (54.2%)
## Number of Observations:
##   log(serBilir): 1945
##   spiders: 1887
## 
## Random-effects covariance matrix:
##       StdDev    Corr        
## (I)1  1.0066  (Int)1   year1
## yer1  0.1723  0.4135        
## (I)2  3.0810  0.4736  0.4288
## 
## Survival Outcome:
##                                   PostMean  StDev  StErr    2.5%  97.5%
## drugD-penicil                      -0.1388 0.3267 0.0109 -0.8010 0.4682
## age                                 0.0412 0.0065 0.0002  0.0281 0.0535
## log(serBilir)_value                 1.2508 0.1168 0.0053  1.0251 1.4756
## log(serBilir)_value:drugD-penicil  -0.0072 0.1352 0.0045 -0.2803 0.2643
## log(serBilir)_slope                 0.7845 0.8128 0.0578 -0.1999 2.6384
## log(serBilir)_slope:drugD-penicil   0.3660 0.6454 0.0204 -0.4409 2.2402
## spiders_area                       -0.0126 0.0102 0.0003 -0.0323 0.0079
## spiders_area:drugD-penicil          0.0110 0.0131 0.0004 -0.0159 0.0382
##                                       P
## drugD-penicil                     0.662
## age                               0.000
## log(serBilir)_value               0.000
## log(serBilir)_value:drugD-penicil 0.970
## log(serBilir)_slope               0.312
## log(serBilir)_slope:drugD-penicil 0.540
## spiders_area                      0.232
## spiders_area:drugD-penicil        0.374
## 
## Longitudinal Outcome: log(serBilir) (family = gaussian, link = identity)
##             PostMean  StDev  StErr   2.5%  97.5% P
## (Intercept)   0.4967 0.0592 0.0019 0.3795 0.6094 0
## year          0.1786 0.0129 0.0004 0.1533 0.2037 0
## sigma         0.3495 0.0068 0.0002 0.3360 0.3649 0
## 
## Longitudinal Outcome: spiders (family = binomial, link = logit)
##             PostMean  StDev  StErr    2.5%   97.5% P
## (Intercept)  -1.6716 0.2212 0.0150 -2.1535 -1.2896 0
## year          0.1830 0.0303 0.0032  0.1234  0.2408 0
## 
## MCMC summary:
## iterations: 900 
## burn-in: 600 
## thinning: 300 
## time: 4.6 min</code></pre>
</div>
<div id="time-varying-effects" class="section level2">
<h2>Time-varying Effects</h2>
<p>A common feature of all aforementioned models is that the regression parameters <span class="math inline">\(\alpha\)</span> that measure the strength of the association between the longitudinal and survival outcomes were assumed to be constant in time. Nonetheless, in some settings it may be plausible that the associationg parameters <span class="math inline">\(\alpha\)</span> change during follow-up. To accomodate such settings <code>mvJointModelBayes()</code> allows modeling the functions <span class="math inline">\(\alpha(t)\)</span> using P-splines. In particular, the definition of the risk model becomes: <span class="math display">\[\begin{eqnarray}
h_i (t \mid \mathcal H_i(t), w_i(t)) &amp; = &amp; h_0(t) \exp \biggl  [\gamma^\top
w_i(t) + \sum \limits_{k = 1}^K \sum \limits_{l = 1}^{L_k} f_{kl} \{\mathcal H_{ki}(t), 
w_i(t), b_{ki}, \alpha_{kl}(t) \} \biggr],
\end{eqnarray}\]</span> and with regard to the estimation we postulate the following set of hierarchical priors: <span class="math display">\[\begin{eqnarray}
\lambda &amp;\sim&amp; \mathcal N(0, \tau_{\lambda}  M)\\&amp;&amp;\\
\tau_{\lambda} &amp;\sim&amp; \mbox{inv-Gamma}(1, 0.005),
\end{eqnarray}\]</span> where <span class="math inline">\(K = \Delta_r^\top \Delta_r + 10^{-6} \mathbf I\)</span>, and <span class="math inline">\(\Delta_r\)</span> denotes the <span class="math inline">\(r\)</span>-th order differences matrix as in the specification of the baseline hazard presented previously.</p>
<p>The time-varying coefficients are specified via the <code>Interactions</code> argument of <code>mvJointModelBayes()</code>. Just as an illustration we extend the univariate model <code>JMFit1</code> to allow for a time-varying association parameter:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Ints_tveffect &lt;-<span class="st">  </span><span class="kw">list</span>(<span class="st">&quot;log(serBilir)_value&quot;</span> =<span class="st"> </span><span class="er">~</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span><span class="kw">tve</span>(Time, <span class="dt">df =</span> <span class="dv">8</span>))
JMFit1_tveffect &lt;-<span class="st"> </span><span class="kw">mvJointModelBayes</span>(MixedModelFit1, CoxFit, <span class="dt">timeVar =</span> <span class="st">&quot;year&quot;</span>,
                                    <span class="dt">Interactions =</span> Ints_tveffect)</code></pre></div>
<p>The <code>plot()</code> method can be used to depict the time-varying effect</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(JMFit1_tveffect, <span class="dt">which =</span> <span class="st">&quot;tv_effect&quot;</span>)</code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<p>The following function can be used to include in the same plot the time-constant and time-varying effects</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">plot_tveffects &lt;-<span class="st"> </span><span class="cf">function</span> (objTVeff, objCeff, <span class="dt">cut_time =</span> <span class="ot">NULL</span>, 
                            <span class="dt">scale =</span> <span class="kw">c</span>(<span class="st">&quot;logHR&quot;</span>, <span class="st">&quot;HR&quot;</span>), <span class="dt">include =</span> <span class="kw">c</span>(<span class="st">&quot;const&quot;</span>, <span class="st">&quot;tv&quot;</span>, <span class="st">&quot;both&quot;</span>)) {
    scale &lt;-<span class="st"> </span><span class="kw">match.arg</span>(scale)
    include &lt;-<span class="st"> </span><span class="kw">match.arg</span>(include)
    tv_effect &lt;-<span class="st"> </span><span class="kw">plot</span>(objTVeff, <span class="st">&quot;tv_effect&quot;</span>, <span class="dt">return_values =</span> <span class="ot">TRUE</span>)[[<span class="dv">1</span>]]
    const_effect &lt;-<span class="st"> </span><span class="kw">cbind</span>(<span class="dt">times =</span> tv_effect[, <span class="dv">1</span>],
                          <span class="dt">est =</span> objCeff<span class="op">$</span>statistics<span class="op">$</span>postMeans<span class="op">$</span>alphas,
                          <span class="dt">low =</span> objCeff<span class="op">$</span>statistics<span class="op">$</span>CIs<span class="op">$</span>alphas[<span class="dv">1</span>, ],
                          <span class="dt">upp =</span> objCeff<span class="op">$</span>statistics<span class="op">$</span>CIs<span class="op">$</span>alphas[<span class="dv">2</span>, ])
    <span class="cf">if</span> (<span class="op">!</span><span class="kw">is.null</span>(cut_time)) {
        tv_effect &lt;-<span class="st"> </span>tv_effect[tv_effect[, <span class="st">&quot;times&quot;</span>] <span class="op">&lt;=</span><span class="st"> </span>cut_time, ]
        const_effect &lt;-<span class="st"> </span>const_effect[const_effect[, <span class="st">&quot;times&quot;</span>] <span class="op">&lt;=</span><span class="st"> </span>cut_time, ]
    }
    <span class="cf">if</span> (scale <span class="op">==</span><span class="st"> &quot;HR&quot;</span>) {
        tv_effect[, <span class="op">-</span><span class="dv">1</span>] &lt;-<span class="st"> </span><span class="kw">exp</span>(tv_effect[, <span class="op">-</span><span class="dv">1</span>])
        const_effect[, <span class="op">-</span><span class="dv">1</span>] &lt;-<span class="st"> </span><span class="kw">exp</span>(const_effect[, <span class="op">-</span><span class="dv">1</span>])
    }
    <span class="kw">matplot</span>(tv_effect[, <span class="dv">1</span>], <span class="kw">cbind</span>(tv_effect[, <span class="op">-</span><span class="dv">1</span>], const_effect[, <span class="op">-</span><span class="dv">1</span>]), <span class="dt">type =</span> <span class="st">&quot;n&quot;</span>,
            <span class="dt">xlab =</span> <span class="st">&quot;Time (years)&quot;</span>, 
            <span class="dt">ylab =</span> <span class="cf">if</span> (scale <span class="op">==</span><span class="st"> &quot;HR&quot;</span>) <span class="st">&quot;Hazard Ratio&quot;</span> <span class="cf">else</span> <span class="st">&quot;log Hazard Ratio&quot;</span>)
    <span class="cf">if</span> (include <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;const&quot;</span>, <span class="st">&quot;both&quot;</span>)) {
        <span class="kw">polygon</span>(<span class="kw">c</span>(const_effect[, <span class="dv">1</span>], <span class="kw">rev</span>(const_effect[, <span class="dv">1</span>])), 
                <span class="kw">c</span>(const_effect[, <span class="dv">3</span>], <span class="kw">rev</span>(const_effect[, <span class="dv">4</span>])), 
                <span class="dt">col =</span> <span class="st">&quot;lightgrey&quot;</span>, <span class="dt">border =</span> <span class="ot">NA</span>)
    }
    <span class="cf">if</span> (include <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;tv&quot;</span>, <span class="st">&quot;both&quot;</span>)) {
        <span class="kw">polygon</span>(<span class="kw">c</span>(tv_effect[, <span class="dv">1</span>], <span class="kw">rev</span>(tv_effect[, <span class="dv">1</span>])), 
                <span class="kw">c</span>(tv_effect[, <span class="dv">3</span>], <span class="kw">rev</span>(tv_effect[, <span class="dv">4</span>])), 
                <span class="dt">col =</span> <span class="st">&quot;grey&quot;</span>, <span class="dt">border =</span> <span class="ot">NA</span>)
    }
    <span class="cf">if</span> (include <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;const&quot;</span>, <span class="st">&quot;both&quot;</span>)) {
        <span class="kw">matlines</span>(const_effect[, <span class="dv">1</span>], const_effect[, <span class="op">-</span><span class="dv">1</span>], <span class="dt">lty =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>), 
                 <span class="dt">col =</span> <span class="dv">1</span>, <span class="dt">lwd =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>))
    }
    <span class="cf">if</span> (include <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;tv&quot;</span>, <span class="st">&quot;both&quot;</span>)) {
        <span class="kw">matlines</span>(tv_effect[, <span class="dv">1</span>], tv_effect[, <span class="op">-</span><span class="dv">1</span>], <span class="dt">lty =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>), 
                 <span class="dt">col =</span> <span class="dv">2</span>, <span class="dt">lwd =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>))
    }
}

<span class="kw">plot_tveffects</span>(JMFit1_tveffect, JMFit1, <span class="dt">include =</span> <span class="st">&quot;both&quot;</span>, <span class="dt">scale =</span> <span class="st">&quot;HR&quot;</span>, <span class="dt">cut_time =</span> <span class="dv">12</span>)</code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
</div>
<div id="left-right-and-interval-censored-data" class="section level2">
<h2>Left, Right and Interval Censored Data</h2>
<p>Function <code>mvJointModelBayes()</code> can also simultaneously handled, right, left and interval censored data. As an example, we first create artificial right, left and interval censoring in the PBC data set:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pbc2<span class="op">$</span>status2 &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(pbc2<span class="op">$</span>status <span class="op">!=</span><span class="st"> &quot;alive&quot;</span>)
pbc2.id<span class="op">$</span>status2 &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(pbc2.id<span class="op">$</span>status <span class="op">!=</span><span class="st"> &quot;alive&quot;</span>)
pbc2<span class="op">$</span>status3 &lt;-<span class="st"> </span><span class="kw">as.character</span>(pbc2<span class="op">$</span>status)
ff &lt;-<span class="st"> </span><span class="cf">function</span> (x) {
    out &lt;-<span class="st"> </span><span class="cf">if</span> (x[1L] <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">'dead'</span>, <span class="st">'transplanted'</span>)) <span class="st">'dead'</span> <span class="cf">else</span> 
        <span class="cf">switch</span>(<span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="dv">1</span>), <span class="st">'1'</span> =<span class="st"> &quot;alive&quot;</span>, <span class="st">'2'</span> =<span class="st"> &quot;left&quot;</span>, <span class="st">'3'</span> =<span class="st"> &quot;interval&quot;</span>)
    <span class="kw">rep</span>(out, <span class="kw">length</span>(x))
}
pbc2<span class="op">$</span>status3 &lt;-<span class="st"> </span><span class="kw">unlist</span>(<span class="kw">with</span>(pbc2, <span class="kw">lapply</span>(<span class="kw">split</span>(status3, id), ff)), <span class="dt">use.names =</span> <span class="ot">FALSE</span>)
pbc2<span class="op">$</span>status3 &lt;-<span class="st"> </span><span class="kw">unname</span>(<span class="kw">with</span>(pbc2, <span class="kw">sapply</span>(status3, <span class="cf">function</span> (x) 
    <span class="cf">switch</span>(x, <span class="st">'dead'</span> =<span class="st"> </span><span class="dv">1</span>, <span class="st">'alive'</span> =<span class="st"> </span><span class="dv">0</span>, <span class="st">'left'</span> =<span class="st"> </span><span class="dv">2</span>, <span class="st">'interval'</span> =<span class="st"> </span><span class="dv">3</span>))))
pbc2<span class="op">$</span>yearsU &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="ot">NA</span>)
pbc2<span class="op">$</span>yearsU[pbc2<span class="op">$</span>status3 <span class="op">==</span><span class="st"> </span><span class="dv">3</span>] &lt;-<span class="st"> </span>pbc2<span class="op">$</span>years[pbc2<span class="op">$</span>status3 <span class="op">==</span><span class="st"> </span><span class="dv">3</span>] <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">runif</span>(<span class="kw">sum</span>(pbc2<span class="op">$</span>status3 <span class="op">==</span><span class="st"> </span><span class="dv">3</span>), <span class="dv">0</span>, <span class="dv">4</span>)
pbc2.id &lt;-<span class="st"> </span>pbc2[<span class="op">!</span><span class="kw">duplicated</span>(pbc2<span class="op">$</span>id), ]</code></pre></div>
<p>Following, we fit a Weibull accelerated failure time (AFT) model accounting for the different types of censoring:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">survFit &lt;-<span class="st"> </span><span class="kw">survreg</span>(<span class="kw">Surv</span>(years, yearsU, status3, <span class="dt">type =</span> <span class="st">&quot;interval&quot;</span>) <span class="op">~</span><span class="st"> </span>drug <span class="op">+</span><span class="st"> </span>age, 
                   <span class="dt">data =</span> pbc2.id, <span class="dt">model =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p>Finally, we fit the joint model with the same call to <code>mvJointModelBayes()</code> as we have previously used.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">JMFit1_intcens &lt;-<span class="st"> </span><span class="kw">mvJointModelBayes</span>(MixedModelFit1, survFit, <span class="dt">timeVar =</span> <span class="st">&quot;year&quot;</span>)
<span class="kw">summary</span>(JMFit1_intcens)</code></pre></div>
<pre><code>## 
## Call:
## mvJointModelBayes(mvglmerObject = MixedModelFit1, survObject = survFit, 
##     timeVar = &quot;year&quot;)
## 
## Data Descriptives:
## Number of Groups: 312        Number of events: 169 (54.2%)
## Number of Observations:
##   log(serBilir): 1945
## 
## Random-effects covariance matrix:
##       StdDev    Corr
## (I)1  1.0081  (Int)1
## yer1  0.1735  0.4016
## 
## Survival Outcome:
##                     PostMean  StDev  StErr    2.5%  97.5%     P
## drugD-penicil        -0.0508 0.1221 0.0026 -0.2823 0.2002 0.702
## age                   0.0228 0.0063 0.0002  0.0109 0.0350 0.000
## log(serBilir)_value   0.7072 0.0583 0.0018  0.5957 0.8221 0.000
## 
## Longitudinal Outcome: log(serBilir) (family = gaussian, link = identity)
##             PostMean  StDev  StErr   2.5%  97.5% P
## (Intercept)   0.4956 0.0596 0.0019 0.3767 0.6096 0
## year          0.1764 0.0130 0.0004 0.1522 0.2026 0
## sigma         0.3489 0.0067 0.0002 0.3366 0.3627 0
## 
## MCMC summary:
## iterations: 900 
## burn-in: 600 
## thinning: 300 
## time: 5.3 min</code></pre>
<p>As previously formulated in the Theory Section, even if the <code>survFit</code> provided to <code>mvJointModelBayes()</code> is an AFT model, the function internally specifies a relative risk model.</p>
</div>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
